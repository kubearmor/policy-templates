# KubeArmor is an open source software that enables you to protect your cloud workload at run-time.
# To learn more about KubeArmor visit:
# https://www.accuknox.com/kubearmor/

apiVersion: security.kubearmor.com/v1
kind: KubeArmorHostPolicy
metadata:
  name: hsp-cve-2019-16884
spec:
  tags: ["AppArmor", "CVE-2019-16884", "rootfs", "Mount-Targets"]
  message: "Alert! rootfs Directory is Created and Docker Binaries are Executed"
  nodeSelector:
    matchLabels:
      kubernetes.io/hostname: gke-ubuntu-1 #change with your hostname
  file:
    severity: 6
    matchPaths:
      - path: /rootfs/proc/self/status
      - path: /rootfs/proc/self/attr/exec
    matchPatterns:
      - pattern: /rootfs/proc/self/status
      - pattern: /rootfs/proc/self/attr/exec
    matchDirectories:
      - dir: /rootfs/proc/self/fd/
    action: Block
  process:
    severity: 4
    matchPaths:
      - path: /usr/bin/docker
      - path: /rootfs/proc/self/attr/exec
    matchPatterns:
      - pattern: /rootfs/proc/self/status
      - pattern: /rootfs/proc/self/attr/exec
    action: Block

# KubeArmor is an open source software that enables you to protect your cloud workload at run-time.
# To learn more about KubeArmor visit:
# https://www.accuknox.com/kubearmor/

apiVersion: security.kubearmor.com/v1
kind: KubeArmorPolicy
metadata:
  name: hsp-cve-2019-16935-xml-rpc-server
  namespace: default    #Change with your namespace
spec:
  tags: ["CVE","CVE-2019-16935","Python","XML-RPC"]
  message: "Python XML-RPC server file accessed by unauthorized user"
  selector:
    matchLabels:
      pod: testpod      # Change with your node label
  process:
    severity: 4
    matchPatterns:
    - pattern: /usr/lib/python*/DocXMLRPCServer.py
      ownerOnly: true
    - pattern: /usr/lib/python*/DocXMLRPCServer.pyc
      ownerOnly: true
    - pattern: /usr/lib/python*/xmlrpc/server.py
      ownerOnly: true
    - pattern: /usr/lib/python*/dist-packages/future/backports/xmlrpc/server.py
      ownerOnly: true
    - pattern: /usr/lib/python*/dist-packages/future/moves/xmlrpc/server.py
      ownerOnly: true
    - pattern: /usr/lib/python*/dist-packages/advancedhttpserver.py
      ownerOnly: true
    - pattern: /usr/lib/python*/dist-packages/aioconsole/server.py
      ownerOnly: true
    - pattern: /usr/lib/python*/dist-packages/aiohttp/web_server.py
      ownerOnly: true
    - pattern: /usr/lib/python*/dist-packages/aioredis/commands/server.py
      ownerOnly: true
    - pattern: /usr/lib/python*/dist-packages/asgiref/server.py
      ownerOnly: true
    - pattern: /usr/lib/python*/dist-packages/cheroot/server.py
      ownerOnly: true
    - pattern: /usr/lib/python*/dist-packages/dbus/server.py
      ownerOnly: true
    - pattern: /usr/lib/python*/dist-packages/dnslib/server.py
      ownerOnly: true
    - pattern: /usr/lib/python*/dist-packages/engineio/server.py
      ownerOnly: true
    - pattern: /usr/lib/python*/dist-packages/faraday/start_server.py
      ownerOnly: true
    - pattern: /usr/lib/python*/dist-packages/faraday_client/gui/gtk/server.py
      ownerOnly: true
    - pattern: /usr/lib/python*/dist-packages/faraday_client/persistence/server/server.py
      ownerOnly: true
    - pattern: /usr/lib/python*/dist-packages/future/backports/http/server.py
      ownerOnly: true
    - pattern: /usr/lib/python*/dist-packages/future/moves/http/server.py
      ownerOnly: true
    - pattern: /usr/lib/python*/dist-packages/ldap3/core/server.py
      ownerOnly: true
    - pattern: /usr/lib/python*/dist-packages/mitmproxy/proxy/server.py
      ownerOnly: true
    - pattern: /usr/lib/python*/dist-packages/msldap/authentication/ntlm/templates/server.py
      ownerOnly: true
    - pattern: /usr/lib/python*/dist-packages/paramiko/server.py
      ownerOnly: true
    - pattern: /usr/lib/python*/dist-packages/paste/httpserver.py
      ownerOnly: true
    - pattern: /usr/lib/python*/dist-packages/samba/tests/dns_forwarder_helpers/server.py
      ownerOnly: true
    - pattern: /usr/lib/python*/dist-packages/socketio/server.py
      ownerOnly: true
    - pattern: /usr/lib/python*/dist-packages/twisted/names/server.py
      ownerOnly: true
    - pattern: /usr/lib/python*/dist-packages/twisted/web/server.py
      ownerOnly: true
    - pattern: /usr/lib/python*/dist-packages/uvicorn/server.py
      ownerOnly: true
    - pattern: /usr/lib/python*/http/server.py
      ownerOnly: true
    - pattern: /usr/share/doc/python*/examples/http_server.py
      ownerOnly: true
    action: Block
  file:
    severity: 4
    matchPatterns:
    - pattern: /usr/lib/python*/DocXMLRPCServer.py
      readOnly: false
      ownerOnly: true
    - pattern: /usr/lib/python*/DocXMLRPCServer.pyc
      readOnly: false
      ownerOnly: true
    - pattern: /usr/lib/python*/xmlrpc/server.py
      readOnly: false
      ownerOnly: true
    - pattern: /usr/lib/python*/dist-packages/future/backports/xmlrpc/server.py
      readOnly: false
      ownerOnly: true
    - pattern: /usr/lib/python*/dist-packages/future/moves/xmlrpc/server.py
      readOnly: false
      ownerOnly: true
    - pattern: /usr/lib/python*/dist-packages/advancedhttpserver.py
      readOnly: false
      ownerOnly: true
    - pattern: /usr/lib/python*/dist-packages/aioconsole/server.py
      readOnly: false
      ownerOnly: true
    - pattern: /usr/lib/python*/dist-packages/aiohttp/web_server.py
      readOnly: false
      ownerOnly: true
    - pattern: /usr/lib/python*/dist-packages/aioredis/commands/server.py
      readOnly: false
      ownerOnly: true
    - pattern: /usr/lib/python*/dist-packages/asgiref/server.py
      readOnly: false
      ownerOnly: true
    - pattern: /usr/lib/python*/dist-packages/cheroot/server.py
      readOnly: false
      ownerOnly: true
    - pattern: /usr/lib/python*/dist-packages/dbus/server.py
      readOnly: false
      ownerOnly: true
    - pattern: /usr/lib/python*/dist-packages/dnslib/server.py
      readOnly: false
      ownerOnly: true
    - pattern: /usr/lib/python*/dist-packages/engineio/server.py
      readOnly: false
      ownerOnly: true
    - pattern: /usr/lib/python*/dist-packages/faraday/start_server.py
      readOnly: false
      ownerOnly: true
    - pattern: /usr/lib/python*/dist-packages/faraday_client/gui/gtk/server.py
      readOnly: false
      ownerOnly: true
    - pattern: /usr/lib/python*/dist-packages/faraday_client/persistence/server/server.py
      readOnly: false
      ownerOnly: true
    - pattern: /usr/lib/python*/dist-packages/future/backports/http/server.py
      readOnly: false
      ownerOnly: true
    - pattern: /usr/lib/python*/dist-packages/future/moves/http/server.py
      readOnly: false
      ownerOnly: true
    - pattern: /usr/lib/python*/dist-packages/ldap3/core/server.py
      readOnly: false
      ownerOnly: true
    - pattern: /usr/lib/python*/dist-packages/mitmproxy/proxy/server.py
      readOnly: false
      ownerOnly: true
    - pattern: /usr/lib/python*/dist-packages/msldap/authentication/ntlm/templates/server.py
      readOnly: false
      ownerOnly: true
    - pattern: /usr/lib/python*/dist-packages/paramiko/server.py
      readOnly: false
      ownerOnly: true
    - pattern: /usr/lib/python*/dist-packages/paste/httpserver.py
      readOnly: false
      ownerOnly: true
    - pattern: /usr/lib/python*/dist-packages/samba/tests/dns_forwarder_helpers/server.py
      readOnly: false
      ownerOnly: true
    - pattern: /usr/lib/python*/dist-packages/socketio/server.py
      readOnly: false
      ownerOnly: true
    - pattern: /usr/lib/python*/dist-packages/twisted/names/server.py
      readOnly: false
      ownerOnly: true
    - pattern: /usr/lib/python*/dist-packages/twisted/web/server.py
      readOnly: false
      ownerOnly: true
    - pattern: /usr/lib/python*/dist-packages/uvicorn/server.py
      readOnly: false
      ownerOnly: true
    - pattern: /usr/lib/python*/http/server.py
      readOnly: false
      ownerOnly: true
    - pattern: /usr/share/doc/python*/examples/http_server.py
      readOnly: false
      ownerOnly: true
    action: Block
